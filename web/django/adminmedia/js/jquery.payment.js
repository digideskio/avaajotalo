jQuery(function(a){"use strict";var b={$csrfToken:null,init:function(){return this.$csrfToken=this.getCookie("csrftoken"),a.ajaxSetup({beforeSend:function(a,b){/^http:./.test(b.url)||/^https:./.test(b.url)||a.setRequestHeader("X-CSRFToken",this.$csrfToken)}}),this},getToken:function(){return"undefined"==typeof this.$csrfToken&&(this.$csrfToken=this.getCookie("csrftoken")),this.$csrfToken},setHeader:function(a){a.setRequestHeader("X-CSRFToken",this.$csrfToken)},getCookie:function(a){var b=null;if(document.cookie&&""!=document.cookie)for(var c=document.cookie.split(";"),d=0;d<c.length;d++){var e=jQuery.trim(c[d]);if(e.substring(0,a.length+1)==a+"="){b=decodeURIComponent(e.substring(a.length+1));break}}return b}},c={$specialKeys:[18,37,38,39,40,8,20,17,46,35,13,27,36,45,144,33,34,16,9,91],$rechargeplanSel:a("#rechargeplan"),$rechargeplanLbl:a("#recharge_total_pr"),$rcLbl:a("#reclbl"),$planCredits:[],$memberPrices:[],$rechargePrices:[],$rechargeCreditPlans:[],$selMemberTotalPrice:0,$selMemberPrice:0,$selPlanIdx:0,$isUnlimitedPlan:!1,$commonApp:null,init:function(a){return this.$specialKeys.push(8),this.$specialKeys.push(16),this.$specialKeys.push(17),this.$specialKeys.push(18),this.$rechargePrices=[999,3499,8599,49999,5e4],this.$rechargeCreditPlans=[1500,6e3,18e3,125e3],this.$selRechargePrice=3499,this.$commonApp=a,this.bindEvents(),this},bindEvents:function(){this.$rechargeplanSel.on("change",this.changeRechargePrice.bind(this))},getRecCalculatedAmt:function(){return this.$selRechargePrice},getCurrentSelectedPlanCredit:function(){var a=this.$rechargeplanSel.val();return this.$rechargeCreditPlans[a]},changeRechargePrice:function(){this.$selPlanIdx=this.$rechargeplanSel.val(),this.$selRechargePrice=this.$rechargePrices[this.$selPlanIdx],this.$rechargeplanLbl.text(this.$commonApp.getFormattedNo(this.$selRechargePrice)),this.$rcLbl.show(),this.$commonApp.changeTotal()}},d={$groupRow:a("#groupRow"),$grpSize:a("#grpsize"),$norGroupLbl:a("#normal-grp"),$grpPriceLbl:a("#grp_total_pr"),$selGroupPrice:0,$selGrpIdx:0,$oneGroupPrice:3798,$commonApp:null,init:function(a){return this.setGrpCalculatedDefaultAmt(),this.$commonApp=a,this.bindEvents(),this},getGrpCalculatedAmt:function(){return this.$selGroupPrice},setGrpCalculatedDefaultAmt:function(){this.$selGroupPrice=this.$oneGroupPrice},resetGrpCalculatedDefaultAmt:function(){this.$selGroupPrice=0},bindEvents:function(){this.$grpSize.on("change",this.changeGroupPrice.bind(this))},changeGroupPrice:function(){this.$selGrpIdx=this.$grpSize.val(),this.$selGroupPrice=this.$oneGroupPrice*this.$selGrpIdx,this.$grpPriceLbl.text(this.$commonApp.getFormattedNo(this.$selGroupPrice)),this.$commonApp.changeTotal()},getSelectedGroup:function(){return this.$grpSize.val()}},e={$couponValInp:a("#coupon"),$couponErrorLbl:a("#couponErrorLbl"),$applyBtn:a("#applyBtn"),$urlInput:a("#coupon_url"),$commonApp:null,init:function(a){return this.$commonApp=a,this.bindEvents(),this},bindEvents:function(){this.$couponValInp.on("dblclick",this.enableCoupon.bind(this)),this.$applyBtn.on("click",this.applyCoupon.bind(this))},enableCoupon:function(){this.$applyBtn.button("reset"),this.$couponValInp.removeAttr("readonly"),this.$couponValInp.val(""),this.$couponErrorLbl.html(""),this.$commonApp.changeTotal()},showError:function(a){this.$couponErrorLbl.html(a),this.$couponErrorLbl.removeClass("label-success-c"),this.$couponErrorLbl.addClass("label-error")},applyCoupon:function(b){b.preventDefault(),this.$applyBtn.button("loading");var c=this.$commonApp.getTotalPriceWithoutTax();if(0>c)this.$couponErrorLbl.text("Total amount should be greater than 0"),this.$couponErrorLbl.addClass("label-error"),this.$applyBtn.button("reset");else{if(""!=this.$couponValInp.val()&&"undefined"!=typeof this.$couponValInp.val()){this.$couponValInp.removeClass("field-error");var d=this;return a.ajax({type:"POST",withCredentials:!0,async:!1,url:d.$urlInput.val(),headers:{csrftoken:this.$commonApp.getCSRFToken()},data:{csrfmiddlewaretoken:this.$commonApp.getCSRFToken(),code:this.$couponValInp.val(),amount:c},success:function(a){return"undefined"!=typeof a.error&&""!=a.error?(d.$couponErrorLbl.html(a.error),d.$couponErrorLbl.removeClass("label-success-c"),d.$couponErrorLbl.addClass("label-error"),d.$couponValInp.addClass("field-error"),d.$commonApp.setNewAmount(a.new_amount)):(d.$couponErrorLbl.html(a.success),d.$couponErrorLbl.removeClass("label-error"),d.$couponErrorLbl.addClass("label-success-c"),d.$couponValInp.removeClass("field-error"),d.$couponValInp.attr("readonly","readonly"),d.$commonApp.setNewAmount(a.new_amount)),d.$applyBtn.button("reset"),!1},error:function(a,b,c){console.log(a),console.log(b),console.log(c),d.$applyBtn.button("reset")}}),!1}this.$couponValInp.addClass("field-error"),this.$couponErrorLbl.text("Please enter coupon code"),this.$couponErrorLbl.addClass("label-error"),this.$applyBtn.button("reset")}return!1}},f={$payBtn:a("#btnpay"),$secureAmt:a("#id_secure_hash"),$amtHidden:a("#id_amount"),$totalPriceBtn:a("#total_prbtn"),$totalPriceWithoutTax:a("#total_pr_without_tax"),$taxPercantage:a("#tax_pr"),$refNoHidden:a("#id_reference_no"),$form:a("#frmTransaction"),$urlInput:a("#hash_url"),$choiceCheckboxes:a("input[name=choiceCheckbox]"),$buyMessagesRadio:a("#buy_messages"),$buyGroupsRadio:a("#buy_groups"),$option:null,$isGroupEnabled:!0,$isMessageEnabled:!0,$csrf:b.init(),$couponApp:null,$groupApp:null,$rechargeApp:null,$tax_percantage:[],$tax_label:[],init:function(){this.$couponApp=e.init(this),this.$groupApp=d.init(this),this.$rechargeApp=c.init(this),this.$option=3,this.bindEvents()},bindEvents:function(){this.$payBtn.on("click",this.getSecureHash.bind(this)),this.$choiceCheckboxes.on("change",this.changePurchaseChoice.bind(this))},changePurchaseChoice:function(b){var c=a(a(b.target).attr("target"));a(b.target).is(":checked")?c.fadeIn(500):c.fadeOut(500),this.$isGroupEnabled=this.$buyGroupsRadio.is(":checked"),this.$isMessageEnabled=this.$buyMessagesRadio.is(":checked"),this.$buyMessagesRadio.is(":checked")||this.$buyGroupsRadio.is(":checked")||(this.$buyMessagesRadio.prop("checked",!0),this.$buyMessagesRadio.trigger("change"),this.$isMessageEnabled=!0),this.changeTotal()},getCurrentAmount:function(){return this.changeTotal(),this.$amtHidden.val()},getSecureHash:function(b){b.preventDefault();var c=0,d=0;this.$isGroupEnabled&&this.$isMessageEnabled?(c=this.$rechargeApp.getCurrentSelectedPlanCredit(),d=this.$groupApp.getSelectedGroup(),this.$option=3):this.$isGroupEnabled?(d=this.$groupApp.getSelectedGroup(),this.$option=1):(c=this.$rechargeApp.getCurrentSelectedPlanCredit(),this.$option=2);var e=this;a.ajax({type:"POST",withCredentials:!0,async:!1,url:e.$urlInput.val(),headers:{csrftoken:this.$csrf.getToken()},data:{csrfmiddlewaretoken:e.$csrf.getToken(),amount:e.$amtHidden.val(),refrenceno:e.$refNoHidden.val(),credits:c,nogroups:d,option:e.$option},success:function(a){"undefined"!=typeof a.error&&""!=a.error?(e.$couponApp.showError(a.error),b.stopPropagation()):(e.$secureAmt.val(a.token),e.$form.submit())},error:function(a,c,d){return console.log(a),console.log(c),console.log(d),e.$applyBtn.button("reset"),b.stopPropagation(),!1}})},getFormattedNo:function(a){var b=a.toString(),c="";b.indexOf(".")>0&&(c=b.substring(b.indexOf("."),b.length)),b=Math.floor(b),b=b.toString();var d=b.substring(b.length-3),e=b.substring(0,b.length-3);return""!=e&&(d=","+d),e.replace(/\B(?=(\d{2})+(?!\d))/g,",")+d+c},calculateTax:function(a){var b=parseFloat(a*this.$tax_percantage/100);return b=parseFloat(b.toFixed(2))},addTaxToTotalAmount:function(a){for(var b=0,c=0;c<this.$tax_percantage.length;c++)b+=parseInt(this.$tax_percantage[c]);var d=parseFloat(a+a*b/100);return d=parseFloat(d.toFixed(2))},changeTotal:function(){var a=0;this.$isMessageEnabled&&(a+=this.$rechargeApp.getRecCalculatedAmt()),this.$isGroupEnabled&&(a+=this.$groupApp.getGrpCalculatedAmt()),this.$totalPriceBtn.text(this.addTaxToTotalAmount(a)),this.$totalPriceWithoutTax.text(a),this.$amtHidden.val(this.addTaxToTotalAmount(a).toFixed(2))},setNewAmount:function(a){this.$totalPriceBtn.text(this.addTaxToTotalAmount(a)),this.$totalPriceWithoutTax.text(a),this.$amtHidden.val(this.addTaxToTotalAmount(a).toFixed(2))},getTotalPriceWithoutTax:function(){var a=0;return this.$isMessageEnabled&&(a+=this.$rechargeApp.getRecCalculatedAmt()),this.$isGroupEnabled&&(a+=this.$groupApp.getGrpCalculatedAmt()),a},getCSRFToken:function(){return this.$csrf.getToken()},setTaxData:function(a,b){this.$tax_percantage=b,this.$tax_label=a;for(var c="(",d=0;d<this.$tax_percantage.length;d++)c+=" + ",c+=this.$tax_label[d],c+=" ",c+=this.$tax_percantage[d],c+="%";c+=" ) ",this.$taxPercantage.text(c),f.changeTotal()}};window.CommonApp=f});